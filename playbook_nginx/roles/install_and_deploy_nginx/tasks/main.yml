---
# tasks file for install_nginx
- name: OFF SELinux from use 9080 port
  shell: 'setenforce 0'

- name: enable 9080
  firewalld:
    port: 9080/tcp
    permanent: true
    state: enabled

- name: enable 9443
  firewalld:
    port: 9443/tcp
    permanent: true
    state: enabled

- name: Reload firewalld
  firewalld:
    reload: yes

- name: Install nginx for server
  package:
    name: nginx
    state: latest
    update_cache: yes

- name: Start nginx for servers
  service:
    name: nginx
    state: started

- name: Copy main config file for nginx - nginx.conf
  template:
    src: ../templates/nginx.conf.j2
    dest: /etc/nginx/nginx.conf
    mode: 0744
  notify: restart nginx
    
- name: Copy config file for nginx - http.conf
  template:
    src: ../templates/http.conf.j2
    dest: /etc/nginx/conf.d/http.conf
    mode: 0744
  notify: restart nginx

- name: Create ssl dir
  file:
    path: /etc/nginx/ssl
    state: directory

- name: Copy cert and key on hosts
  copy:
    src: "../files/{{ item }}"
    dest: "{{ ssl_dir }}"
  with_items:
    - example.crt
    - example.key
